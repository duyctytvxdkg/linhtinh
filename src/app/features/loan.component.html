<!DOCTYPE html>
<div class="content-box">
  <h2 class="text-3xl font-bold text-blue-700 mb-4">
    ðŸ’µ CÃ´ng Cá»¥ TÃ­nh Khoáº£n Vay (EMI)
  </h2>

  <form [formGroup]="form" class="grid grid-cols-1 md:grid-cols-3 gap-6">
    <div>
      <mat-form-field appearance="outline">
        <mat-label>Khoáº£n vay gá»‘c (VND)</mat-label>
        <input matInput type="number" formControlName="principal" />
        <mat-error *ngIf="form.get('principal')?.invalid">
          Khoáº£n vay pháº£i > 0
        </mat-error>
      </mat-form-field>
    </div>

    <div>
      <mat-form-field appearance="outline">
        <mat-label>LÃ£i suáº¥t nÄƒm (%)</mat-label>
        <input matInput type="number" formControlName="annualRate" />
      </mat-form-field>
    </div>

    <div>
      <mat-form-field appearance="outline">
        <mat-label>Ká»³ háº¡n (thÃ¡ng)</mat-label>
        <input matInput type="number" formControlName="termMonths" />
      </mat-form-field>
    </div>
  </form>

  <!-- TÃ“M Táº®T -->
  <div class="mt-6 p-4 bg-blue-50 rounded-xl" *ngIf="form.valid">
    <p>
      <strong>EMI:</strong>
      <span class="text-green-600 font-bold">
        {{ currencyFormat(monthlyPayment) }} VND
      </span>
    </p>
    <p>
      <strong>Tá»•ng lÃ£i:</strong>
      {{ currencyFormat(totalInterest) }} VND
    </p>
    <p>
      <strong>Tá»•ng thanh toÃ¡n:</strong>
      {{ currencyFormat(totalPayment) }} VND
    </p>
  </div>

  <div class="table-scroll">
    <!-- TABLE -->
    <div class="mt-6" *ngIf="amortizationSchedule.length">
      <table mat-table [dataSource]="amortizationSchedule">
        <ng-container matColumnDef="period">
          <th mat-header-cell *matHeaderCellDef>Ká»³</th>
          <td mat-cell *matCellDef="let e">{{ e.period }}</td>
        </ng-container>

        <ng-container matColumnDef="startingBalance">
          <th mat-header-cell *matHeaderCellDef>Vá»‘n Ä‘áº§u ká»³</th>
          <td mat-cell *matCellDef="let e">
            {{ currencyFormat(e.startingBalance) }}
          </td>
        </ng-container>

        <ng-container matColumnDef="interestPaid">
          <th mat-header-cell *matHeaderCellDef>Tráº£ lÃ£i</th>
          <td mat-cell *matCellDef="let e" class="text-red-600">
            {{ currencyFormat(e.interestPaid) }}
          </td>
        </ng-container>

        <ng-container matColumnDef="principalPaid">
          <th mat-header-cell *matHeaderCellDef>Tráº£ gá»‘c</th>
          <td mat-cell *matCellDef="let e" class="text-green-600">
            {{ currencyFormat(e.principalPaid) }}
          </td>
        </ng-container>

        <ng-container matColumnDef="endingBalance">
          <th mat-header-cell *matHeaderCellDef>DÆ° cuá»‘i</th>
          <td mat-cell *matCellDef="let e">
            {{ currencyFormat(e.endingBalance) }}
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>
  </div>
</div>
