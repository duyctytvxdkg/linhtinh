<div class="content-box-minor space-y-6">
  <h2 class="text-2xl font-bold text-blue-700">
    ğŸ§“ TÃNH LÆ¯Æ NG HÆ¯U (THEO BHXH 2025 â€“ Æ¯á»šC TÃNH)
  </h2>

  <form [formGroup]="form" class="space-y-6">
    <!-- GIá»šI TÃNH -->
    <div>
      <label class="font-semibold mr-4">Giá»›i tÃ­nh:</label>
      <mat-radio-group formControlName="gender">
        <mat-radio-button value="male">Nam</mat-radio-button>
        <mat-radio-button value="female" class="ml-4">Ná»¯</mat-radio-button>
      </mat-radio-group>
    </div>

    <!-- Báº¢NG QUÃ TRÃŒNH LÃ€M VIá»†C -->
    <table mat-table [dataSource]="dataSource" class="w-full" #workTable>
      <!-- Tá»ª -->
      <ng-container matColumnDef="from">
        <th mat-header-cell *matHeaderCellDef>Tá»«</th>
        <td mat-cell *matCellDef="let row">
          <input
            type="month"
            class="border p-1"
            [formControl]="row.get('from')"
          />
        </td>
      </ng-container>

      <!-- Äáº¾N -->
      <ng-container matColumnDef="to">
        <th mat-header-cell *matHeaderCellDef>Äáº¿n</th>
        <td mat-cell *matCellDef="let row">
          <input
            type="month"
            class="border p-1"
            [formControl]="row.get('to')"
          />
        </td>
      </ng-container>

      <!-- LÆ¯Æ NG -->
      <ng-container matColumnDef="salary">
        <th mat-header-cell *matHeaderCellDef>LÆ°Æ¡ng Ä‘Ã³ng BHXH</th>
        <td mat-cell *matCellDef="let row">
          <input
            type="text"
            currencyInput
            class="border p-1 text-right"
            [formControl]="row.get('salary')"
          />
        </td>
      </ng-container>

      <!-- XÃ“A -->
      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let row; let i = index">
          <button
            type="button"
            mat-icon-button
            color="warn"
            (click)="removeRow(i)"
          >
            âœ–
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <button type="button" mat-stroked-button (click)="addRow()">
      â• ThÃªm dÃ²ng
    </button>

    <div class="flex gap-3 mt-4">
      <button
        type="button"
        mat-stroked-button
        color="primary"
        (click)="exportCSV()"
      >
        ğŸ’¾ LÆ°u ra CSV
      </button>

      <button
        type="button"
        mat-stroked-button
        color="accent"
        (click)="fileInput.click()"
      >
        ğŸ“‚ Import CSV
      </button>

      <input
        #fileInput
        type="file"
        accept=".csv"
        hidden
        (change)="importCSV($event)"
      />
    </div>

    <div>
      <button
        type="button"
        mat-raised-button
        color="primary"
        (click)="calculate()"
      >
        TÃ­nh lÆ°Æ¡ng hÆ°u
      </button>
    </div>
  </form>

  <!-- Káº¾T QUáº¢ -->
  <div *ngIf="result" class="border rounded p-4 space-y-2">
    <p>
      â³ Tá»•ng thá»i gian Ä‘Ã³ng: <b>{{ result.totalYears }}</b> nÄƒm
    </p>

    <p *ngIf="!result.eligible" class="text-red-600">
      âš ï¸ ChÆ°a Ä‘á»§ Ä‘iá»u kiá»‡n hÆ°á»Ÿng lÆ°Æ¡ng hÆ°u (tá»‘i thiá»ƒu 20 nÄƒm)
    </p>

    <ng-container *ngIf="result.eligible">
      <p>
        ğŸ“ˆ Tá»· lá»‡ hÆ°á»Ÿng: <b>{{ result.rate }}%</b>
      </p>
      <p>
        ğŸ’° BÃ¬nh quÃ¢n lÆ°Æ¡ng: <b>{{ result.avgSalary | number }}</b> VND
      </p>
      <p class="text-green-700 text-xl font-bold">
        ğŸ‘‰ LÆ°Æ¡ng hÆ°u Æ°á»›c tÃ­nh:
        {{ result.pension | number }} VND / thÃ¡ng
      </p>
    </ng-container>
  </div>
</div>
